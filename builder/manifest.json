{
  "tuf": {
    "repository": "https://dl.flynn.cloud.randygirard.com/tuf",
    "root_keys": [
      {
        "keytype": "ed25519",
        "keyval": {
          "public": "781538e2a9bda1f28592866b305f4bfd67e5c36715693347c6eb3480082f7a32"
        }
      }
    ]
  },
  "base_layer": {
    "type": "squashfs",
    "id": "local-base",
    "url": "file:///var/lib/flynn/base-layer.squashfs",
    "size": 81035264,
    "hashes": {
      "sha512_256": "6b951fdaaaa1b8f2342a88872e15e7a69ba8fccb9e464784cc810eb0a8fd7314"
    }
  },
  "images": [
    {
      "id": "ubuntu-noble",
      "layers": [
        {
          "script": "builder/img/ubuntu-noble.sh",
          "inputs": [
            "builder/ubuntu-setup.sh"
          ],
          "limits": {
            "temp_disk": "2GB"
          },
          "linux_capabilities": [
            "CAP_SYS_ADMIN"
          ]
        }
      ]
    },
    {
      "id": "busybox",
      "layers": [
        {
          "script": "builder/img/busybox.sh"
        }
      ]
    },
    {
      "id": "go",
      "base": "ubuntu-noble",
      "layers": [
        {
          "script": "builder/img/go.sh",
          "inputs": [
            "builder/go-wrapper.sh"
          ]
        }
      ]
    },
    {
      "id": "protoc",
      "base": "go",
      "layers": [
        {
          "script": "builder/img/protoc.sh",
          "inputs": [
            "go.mod",
            "go.sum",
            "vendor/**"
          ]
        }
      ]
    },
    {
      "id": "builder",
      "base": "go",
      "layers": [
        {
          "gobuild": {
            "builder": "/bin/flynn-builder"
          }
        }
      ]
    },
    {
      "id": "build-tools",
      "base": "go",
      "layers": [
        {
          "script": "builder/img/build-tools.sh",
          "inputs": [
            "go.mod",
            "go.sum",
            "vendor/**",
            "go-tuf/**"
          ]
        }
      ]
    },
    {
      "id": "discoverd",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "discoverd": "/bin/discoverd"
          },
          "copy": {
            "discoverd/start.sh": "/bin/start-discoverd"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/start-discoverd"
        ]
      }
    },
    {
      "id": "flannel",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "flannel": "/bin/flanneld",
            "flannel/wrapper": "/bin/flannel-wrapper"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/flannel-wrapper"
        ]
      }
    },
    {
      "id": "host",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "host-packages",
          "script": "host/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "host-binaries",
          "env": {
            "FLYNN_VERSION": "{{ .Version }}",
            "TUF_ROOT_KEYS": "{{ .TUFRootKeys }}"
          },
          "cgobuild": {
            "host": "/usr/local/bin/flynn-host"
          },
          "gobuild": {
            "host/flynn-init": "/usr/local/bin/flynn-init"
          },
          "copy": {
            "util/ca-certs/ca-certs.pem": "/etc/ssl/certs/ca-certs.pem",
            "host/zfs-mknod.sh": "/usr/local/bin/zfs-mknod",
            "host/udev.rules": "/lib/udev/rules.d/10-local.rules",
            "host/start.sh": "/usr/local/bin/start-flynn-host.sh",
            "host/cleanup.sh": "/usr/local/bin/cleanup-flynn-host.sh"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/usr/local/bin/start-flynn-host.sh"
        ]
      }
    },
    {
      "id": "controller",
      "base": "busybox",
      "layers": [
        {
          "protobuild": [
            "controller/api"
          ]
        },
        {
          "gobuild": {
            "controller": "/bin/flynn-controller",
            "controller/scheduler": "/bin/flynn-scheduler",
            "controller/worker": "/bin/flynn-worker"
          },
          "copy": {
            "controller/start.sh": "/bin/start-flynn-controller",
            "util/ca-certs/ca-certs.pem": "/etc/ssl/certs/ca-certs.pem"
          },
          "inputs": [
            "schema/*.json",
            "schema/controller/*.json",
            "schema/router/*.json"
          ],
          "run": [
            "mkdir -p /etc/flynn-controller",
            "cp -r schema /etc/flynn-controller/jsonschema"
          ],
          "limits": {
            "temp_disk": "1G"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/start-flynn-controller"
        ]
      }
    },
    {
      "id": "controller-examples",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "controller/examples": "/bin/flynn-controller-examples"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/flynn-controller-examples"
        ]
      }
    },
    {
      "id": "postgres",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "postgres-packages",
          "script": "appliance/postgresql/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "postgres-binaries",
          "gobuild": {
            "appliance/postgresql/cmd/flynn-postgres": "/bin/flynn-postgres",
            "appliance/postgresql/cmd/flynn-postgres-api": "/bin/flynn-postgres-api"
          },
          "copy": {
            "appliance/postgresql/start.sh": "/bin/start-flynn-postgres"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/start-flynn-postgres"
        ]
      }
    },
    {
      "id": "mariadb",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "mariadb-packages",
          "script": "appliance/mariadb/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "mariadb-binaries",
          "gobuild": {
            "appliance/mariadb/cmd/flynn-mariadb": "/bin/flynn-mariadb",
            "appliance/mariadb/cmd/flynn-mariadb-api": "/bin/flynn-mariadb-api"
          },
          "copy": {
            "appliance/mariadb/start.sh": "/bin/start-flynn-mariadb"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/start-flynn-mariadb"
        ]
      }
    },
    {
      "id": "mongodb",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "mongodb-packages",
          "script": "appliance/mongodb/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "mongodb-binaries",
          "gobuild": {
            "appliance/mongodb/cmd/flynn-mongodb": "/bin/flynn-mongodb",
            "appliance/mongodb/cmd/flynn-mongodb-api": "/bin/flynn-mongodb-api"
          },
          "copy": {
            "appliance/mongodb/start.sh": "/bin/start-flynn-mongodb",
            "appliance/mongodb/dump.sh": "/bin/dump-flynn-mongodb",
            "appliance/mongodb/restore.sh": "/bin/restore-flynn-mongodb"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/start-flynn-mongodb"
        ]
      }
    },
    {
      "id": "redis",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "redis-packages",
          "script": "appliance/redis/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "redis-binaries",
          "gobuild": {
            "appliance/redis/cmd/flynn-redis": "/bin/flynn-redis",
            "appliance/redis/cmd/flynn-redis-api": "/bin/flynn-redis-api"
          },
          "copy": {
            "appliance/redis/start.sh": "/bin/start-flynn-redis",
            "appliance/redis/dump.sh": "/bin/dump-flynn-redis",
            "appliance/redis/restore.sh": "/bin/restore-flynn-redis"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/start-flynn-redis"
        ]
      }
    },
    {
      "id": "blobstore",
      "base": "ubuntu-noble",
      "layers": [
        {
          "gobuild": {
            "blobstore": "/bin/flynn-blobstore"
          },
          "copy": {
            "util/ca-certs/ca-certs.pem": "/etc/ssl/certs/ca-certs.pem"
          },
          "limits": {
            "temp_disk": "2G"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/flynn-blobstore",
          "server"
        ]
      }
    },
    {
      "id": "router",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "router": "/bin/flynn-router"
          },
          "copy": {
            "util/ca-certs/ca-certs.pem": "/etc/ssl/certs/ca-certs.pem"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/flynn-router"
        ]
      }
    },
    {
      "id": "acme",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "router/acme/cmd/acme": "/bin/flynn-acme"
          },
          "copy": {
            "util/ca-certs/ca-certs.pem": "/etc/ssl/certs/ca-certs.pem"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/flynn-acme"
        ]
      }
    },
    {
      "id": "gitreceive",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "gitreceive-packages",
          "script": "gitreceive/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "gitreceive-binaries",
          "gobuild": {
            "gitreceive": "/bin/gitreceived",
            "gitreceive/receiver": "/bin/flynn-receiver"
          },
          "copy": {
            "gitreceive/start.sh": "/bin/start-flynn-receiver"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/start-flynn-receiver"
        ]
      }
    },
    {
      "id": "tarreceive",
      "base": "ubuntu-noble",
      "layers": [
        {
          "gobuild": {
            "tarreceive": "/bin/tarreceive"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/tarreceive"
        ]
      }
    },
    {
      "id": "logaggregator",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "logaggregator": "/bin/logaggregator"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/logaggregator"
        ]
      }
    },
    {
      "id": "taffy",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "taffy-packages",
          "script": "gitreceive/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "taffy-binaries",
          "gobuild": {
            "taffy": "/bin/taffy",
            "gitreceive/receiver": "/bin/flynn-receiver"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/taffy"
        ]
      }
    },
    {
      "id": "heroku-24",
      "base": "ubuntu-noble",
      "layers": [
        {
          "script": "builder/img/heroku-24.sh",
          "limits": {
            "temp_disk": "2G"
          }
        }
      ]
    },
    {
      "id": "heroku-24-build",
      "base": "heroku-24",
      "layers": [
        {
          "script": "builder/img/heroku-24-build.sh",
          "limits": {
            "temp_disk": "2G"
          }
        }
      ]
    },
    {
      "id": "slugbuilder-24",
      "base": "heroku-24-build",
      "layers": [
        {
          "name": "slugbuilder-packages",
          "script": "slugbuilder/img/packages.sh",
          "inputs": [
            "slugbuilder/builder/buildpacks.txt",
            "slugbuilder/builder/install-buildpack"
          ]
        },
        {
          "name": "slugbuilder-binaries",
          "gobuild": {
            "slugbuilder/artifact": "/bin/create-artifact",
            "slugbuilder/migrator": "/bin/slug-migrator"
          },
          "copy": {
            "slugbuilder/convert-legacy-slug.sh": "/bin/convert-legacy-slug.sh",
            "slugbuilder/builder/build.sh": "/builder/build.sh",
            "slugbuilder/builder/create-user.sh": "/builder/create-user.sh"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/builder/build.sh"
        ]
      }
    },
    {
      "id": "slugrunner-24",
      "base": "heroku-24",
      "layers": [
        {
          "copy": {
            "slugrunner/runner/init": "/runner/init"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/runner/init"
        ]
      }
    },
    {
      "id": "status",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "status": "/bin/flynn-status"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/flynn-status"
        ]
      }
    },
    {
      "id": "updater",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "updater": "/bin/updater"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/updater"
        ]
      }
    },
    {
      "id": "release",
      "base": "busybox",
      "layers": [
        {
          "gobuild": {
            "util/release": "/bin/flynn-release"
          }
        }
      ]
    },
    {
      "id": "cli-linux-amd64",
      "base": "busybox",
      "env": {
        "GOOS": "linux",
        "GOARCH": "amd64"
      },
      "template": "cli"
    },
    {
      "id": "cli-linux-386",
      "base": "busybox",
      "env": {
        "GOOS": "linux",
        "GOARCH": "386"
      },
      "template": "cli"
    },
    {
      "id": "cli-darwin-amd64",
      "base": "busybox",
      "env": {
        "GOOS": "darwin",
        "GOARCH": "amd64"
      },
      "template": "cli"
    },
    {
      "id": "cli-windows-amd64",
      "base": "busybox",
      "env": {
        "GOOS": "windows",
        "GOARCH": "amd64"
      },
      "template": "cli"
    },
    {
      "id": "cli-windows-386",
      "base": "busybox",
      "env": {
        "GOOS": "windows",
        "GOARCH": "386"
      },
      "template": "cli"
    },
    {
      "id": "test",
      "base": "ubuntu-noble",
      "layers": [
        {
          "name": "test-packages",
          "script": "test/img/packages.sh",
          "limits": {
            "temp_disk": "4G"
          }
        },
        {
          "name": "test-binaries",
          "cgobuild": {
            "test": "/bin/flynn-test",
            "test/runner": "/bin/flynn-test-runner"
          },
          "gobuild": {
            "test/util/file-server": "/bin/flynn-test-file-server"
          },
          "copy": {
            "test/run.sh": "/bin/run-flynn-test.sh",
            "test/vm.sh": "/bin/run-vm.sh",
            "test/scripts/start.sh": "/test/bin/start-runner.sh",
            "test/rootfs/build.sh": "/test/rootfs/build.sh",
            "test/rootfs/setup.sh": "/test/rootfs/setup.sh",
            "test/runner/assets/build-log.html": "/test/assets/",
            "test/runner/assets/build-log.js": "/test/assets/",
            "test/runner/assets/builds.js": "/test/assets/",
            "test/runner/assets/index.html": "/test/assets/",
            "test/runner/assets/style.css": "/test/assets/",
            "test/runner/assets/ansi_up/ansi_up.js": "/test/assets/ansi_up/"
          }
        }
      ],
      "entrypoint": {
        "args": [
          "/bin/run-flynn-test.sh"
        ]
      }
    },
    {
      "id": "test-apps",
      "base": "busybox",
      "layers": [
        {
          "build_with": "ubuntu-noble",
          "name": "test-apps-minio",
          "script": "test/apps/minio.sh"
        },
        {
          "name": "test-apps-binaries",
          "gobuild": {
            "test/apps/echoer": "/bin/echoer",
            "test/apps/ping": "/bin/pingserv",
            "test/apps/signal": "/bin/signal",
            "test/apps/ish": "/bin/ish",
            "test/apps/partial-logger": "/bin/partial-logger",
            "test/apps/http-blocker": "/bin/http-blocker",
            "test/apps/oom": "/bin/oom",
            "test/apps/proxy": "/bin/proxy"
          }
        }
      ]
    }
  ],
  "templates": {
    "cli": {
      "layers": [
        {
          "env": {
            "FLYNN_VERSION": "{{ .Version }}",
            "TUF_ROOT_KEYS": "{{ .TUFRootKeys }}",
            "TUF_REPOSITORY": "{{ .TUFRepository }}"
          },
          "gobuild": {
            "cli": "/bin/flynn-${GOOS}-${GOARCH}"
          }
        }
      ]
    }
  },
  "manifests": {
    "bootstrap/manifest_template.json": "bootstrap-manifest.json",
    "util/release/images_template.json": "images.json"
  }
}
